import{d as M,H,c as u,a as l,u as s,h as J,w as d,b as r,f as i,o as n,p,g as m,F as g,E as h,e as V,v as L,A as O,B as P,j as S,r as k,I as w,J as q}from"./app-BE6QdeMr.js";import{_ as G}from"./AppLayout.vue_vue_type_script_setup_true_lang-D2c59wsq.js";import{_ as I}from"./index-D3jlIiru.js";import{_ as c}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-Dk4QiK2X.js";import{_ as $}from"./Input.vue_vue_type_script_setup_true_lang-B7WzRkgV.js";import{_ as v}from"./Label.vue_vue_type_script_setup_true_lang-DH01CRbA.js";import{_ as K,a as Q,b as R,c as W}from"./DialogTitle.vue_vue_type_script_setup_true_lang-CkescQCB.js";import"./index-BSn_kBxy.js";import"./VisuallyHidden-C267o_qF.js";import"./useForwardExpose-HElGGXL4.js";import"./useForwardPropsEmits-DTJkXGuD.js";import"./index-B26eXW15.js";import"./loader-circle-B1nvjyWE.js";const X={class:"flex flex-col gap-6 p-4"},Y={class:"flex flex-wrap items-center justify-between gap-4"},Z={key:0,class:"rounded-md border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700 dark:border-red-900/50 dark:bg-red-950/40 dark:text-red-200"},T={class:"overflow-hidden rounded-xl border border-sidebar-border/70 bg-white dark:border-sidebar-border dark:bg-neutral-900"},ee={class:"w-full text-left text-sm"},se={class:"px-4 py-3"},te={class:"px-4 py-3"},re={class:"px-4 py-3"},oe={class:"px-4 py-3"},le={class:"px-4 py-3"},ae={class:"flex flex-wrap gap-2"},de={key:0},ne={class:"grid gap-2"},ie={key:0,class:"text-sm text-red-600"},ue={class:"grid gap-2"},pe={key:0,class:"text-sm text-red-600"},me={class:"grid gap-2"},_e={key:0,class:"text-sm text-red-600"},ce={class:"grid gap-2"},fe={class:"max-h-40 space-y-2 overflow-y-auto rounded-md border border-input p-3"},xe=["checked","onChange"],ve={key:0,class:"text-xs text-muted-foreground"},be={key:0,class:"text-sm text-red-600"},ye={class:"grid gap-2"},ge={key:0,class:"text-sm text-red-600"},ke={class:"flex justify-end gap-2"},De=M({__name:"Index",setup(we){const E=q(),f=S(()=>E.props),C=S(()=>f.value.errors??{}),U=[{title:"Адмін",href:"/admin/users"},{title:"Користувачі",href:"/admin/users"}],_=k(!1),x=k(!1),b=k(null),t=H({name:"",email:"",role:"user",password:"",editable_expense_type_ids:[]}),B=()=>{x.value=!1,b.value=null,t.reset(),t.clearErrors(),t.editable_expense_type_ids=[],_.value=!0},z=a=>{x.value=!0,b.value=a,t.name=a.name,t.email=a.email,t.role=a.role,t.password="",t.editable_expense_type_ids=[...a.editable_expense_type_ids??[]],t.clearErrors(),_.value=!0},N=a=>{if(t.editable_expense_type_ids.includes(a)){t.editable_expense_type_ids=t.editable_expense_type_ids.filter(e=>e!==a);return}t.editable_expense_type_ids=[...t.editable_expense_type_ids,a]},j=()=>{if(x.value&&b.value){if(!window.confirm("Підтвердити оновлення користувача?"))return;t.transform(e=>{const o={...e};return o.password||delete o.password,o}),t.put(`/admin/users/${b.value.id}`,{preserveScroll:!0,onSuccess:()=>{_.value=!1}});return}t.transform(a=>a),t.post("/admin/users",{preserveScroll:!0,onSuccess:()=>{_.value=!1,t.reset()}})},F=a=>{window.confirm("Заблокувати користувача?")&&w.patch(`/admin/users/${a.id}/block`,{},{preserveScroll:!0})},A=a=>{window.confirm("Розблокувати користувача?")&&w.patch(`/admin/users/${a.id}/unblock`,{},{preserveScroll:!0})},D=a=>{window.confirm("Видалити користувача?")&&w.delete(`/admin/users/${a.id}`,{preserveScroll:!0})};return(a,e)=>(n(),u(g,null,[l(s(J),{title:"Користувачі"}),l(G,{breadcrumbs:U},{default:d(()=>[r("div",X,[r("div",Y,[e[7]||(e[7]=r("div",null,[r("h1",{class:"text-xl font-semibold"},"Користувачі"),r("p",{class:"text-sm text-muted-foreground"},"Керування користувачами лише для адміністратора.")],-1)),l(s(c),{onClick:B},{default:d(()=>[...e[6]||(e[6]=[i("Створити користувача",-1)])]),_:1})]),C.value.user?(n(),u("div",Z,[r("p",null,p(C.value.user),1)])):m("",!0),r("div",T,[r("table",ee,[e[13]||(e[13]=r("thead",{class:"border-b border-sidebar-border/70 text-xs uppercase text-muted-foreground"},[r("tr",null,[r("th",{class:"px-4 py-3"},"Ім'я"),r("th",{class:"px-4 py-3"},"Email"),r("th",{class:"px-4 py-3"},"Роль"),r("th",{class:"px-4 py-3"},"Статус"),r("th",{class:"px-4 py-3"},"Дії")])],-1)),r("tbody",null,[(n(!0),u(g,null,h(f.value.users,o=>(n(),u("tr",{key:o.id,class:"border-b border-sidebar-border/40"},[r("td",se,p(o.name),1),r("td",te,p(o.email),1),r("td",re,p(o.role),1),r("td",oe,[l(s(I),{variant:o.blocked_at?"destructive":"secondary"},{default:d(()=>[i(p(o.blocked_at?"Заблоковано":"Активний"),1)]),_:2},1032,["variant"])]),r("td",le,[r("div",ae,[l(s(c),{size:"sm",variant:"outline",onClick:y=>z(o)},{default:d(()=>[...e[8]||(e[8]=[i("Редагувати",-1)])]),_:1},8,["onClick"]),o.blocked_at?(n(),V(s(c),{key:1,size:"sm",variant:"secondary",onClick:y=>A(o)},{default:d(()=>[...e[10]||(e[10]=[i(" Розблокувати ",-1)])]),_:1},8,["onClick"])):(n(),V(s(c),{key:0,size:"sm",variant:"secondary",onClick:y=>F(o)},{default:d(()=>[...e[9]||(e[9]=[i(" Заблокувати ",-1)])]),_:1},8,["onClick"])),l(s(c),{size:"sm",variant:"destructive",onClick:y=>D(o)},{default:d(()=>[...e[11]||(e[11]=[i("Видалити",-1)])]),_:1},8,["onClick"])])])]))),128)),f.value.users.length===0?(n(),u("tr",de,[...e[12]||(e[12]=[r("td",{class:"px-4 py-6 text-center text-muted-foreground",colspan:"5"},"Користувачі відсутні.",-1)])])):m("",!0)])])])]),l(s(K),{open:_.value,"onUpdate:open":e[5]||(e[5]=o=>_.value=o)},{default:d(()=>[l(s(Q),null,{default:d(()=>[l(s(R),null,{default:d(()=>[l(s(W),null,{default:d(()=>[i(p(x.value?"Редагувати користувача":"Створити користувача"),1)]),_:1})]),_:1}),r("form",{class:"mt-4 grid gap-4",onSubmit:L(j,["prevent"])},[r("div",ne,[l(s(v),null,{default:d(()=>[...e[14]||(e[14]=[i("Ім'я",-1)])]),_:1}),l(s($),{modelValue:s(t).name,"onUpdate:modelValue":e[0]||(e[0]=o=>s(t).name=o)},null,8,["modelValue"]),s(t).errors.name?(n(),u("span",ie,p(s(t).errors.name),1)):m("",!0)]),r("div",ue,[l(s(v),null,{default:d(()=>[...e[15]||(e[15]=[i("Email",-1)])]),_:1}),l(s($),{modelValue:s(t).email,"onUpdate:modelValue":e[1]||(e[1]=o=>s(t).email=o),type:"email"},null,8,["modelValue"]),s(t).errors.email?(n(),u("span",pe,p(s(t).errors.email),1)):m("",!0)]),r("div",me,[l(s(v),null,{default:d(()=>[...e[16]||(e[16]=[i("Роль",-1)])]),_:1}),O(r("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>s(t).role=o),class:"h-9 rounded-md border border-input bg-transparent px-3 text-sm"},[...e[17]||(e[17]=[r("option",{value:"user"},"Користувач",-1),r("option",{value:"accountant"},"Бухгалтер",-1),r("option",{value:"admin"},"Адміністратор",-1)])],512),[[P,s(t).role]]),s(t).errors.role?(n(),u("span",_e,p(s(t).errors.role),1)):m("",!0)]),r("div",ce,[l(s(v),null,{default:d(()=>[...e[18]||(e[18]=[i("Доступ до типів витрат (категорії)",-1)])]),_:1}),r("div",fe,[(n(!0),u(g,null,h(f.value.expenseTypes,o=>(n(),u("label",{key:o.id,class:"flex items-center gap-2 text-sm"},[r("input",{type:"checkbox",class:"h-4 w-4",checked:s(t).editable_expense_type_ids.includes(o.id),onChange:y=>N(o.id)},null,40,xe),r("span",null,p(o.name),1)]))),128)),f.value.expenseTypes.length===0?(n(),u("p",ve," Типи витрат відсутні. ")):m("",!0)]),s(t).errors.editable_expense_type_ids?(n(),u("span",be,p(s(t).errors.editable_expense_type_ids),1)):m("",!0)]),r("div",ye,[l(s(v),null,{default:d(()=>[...e[19]||(e[19]=[i("Пароль",-1)])]),_:1}),l(s($),{modelValue:s(t).password,"onUpdate:modelValue":e[3]||(e[3]=o=>s(t).password=o),type:"password",placeholder:x.value?"Залиште порожнім, щоб не змінювати":""},null,8,["modelValue","placeholder"]),s(t).errors.password?(n(),u("span",ge,p(s(t).errors.password),1)):m("",!0)]),r("div",ke,[l(s(c),{type:"button",variant:"ghost",onClick:e[4]||(e[4]=o=>_.value=!1)},{default:d(()=>[...e[20]||(e[20]=[i("Скасувати",-1)])]),_:1}),l(s(c),{type:"submit",disabled:s(t).processing},{default:d(()=>[...e[21]||(e[21]=[i("Зберегти",-1)])]),_:1},8,["disabled"])])],32)]),_:1})]),_:1},8,["open"])]),_:1})],64))}});export{De as default};
